<div *ngIf="apiRequesting">Loading...</div>
<div *ngIf="!restaurant">
  <div *ngIf="!apiRequesting">NO RESTAURANT FOUND</div>
</div>

<div *ngIf="restaurant">
  <div class="text-center text-light">
    <q-banner [maskingColor]="'rgba(0, 0, 0, 0.3)'"
      [backgroundImageUrl]="(restaurant.images && restaurant.images[restaurant.images.length - 1] || '')">
      <div>
        <img src="{{restaurant.logo}}" [attr.alt]="restaurant.name" class="logo">
      </div>
      <h2>{{restaurant.name}}</h2>

      <div class="small">
        {{restaurant.googleAddress.formatted_address}}
        (<a class="google_link" href="{{googleSearchText}}" target="_blank">Google<i
            class="fas fa-external-link-alt"></i></a>)
      </div>
      <div class="small">
        Time: {{now| adjustedDate: 'h:mm a':restaurant.googleAddress.timezone}}, {{openOrNot?'Open':'Closed'}}
        <ng-container *ngIf="getBizContacts()">, {{getBizContacts()}}</ng-container>
        <ng-container *ngIf="valueVisible()">(Value: {{ displayValue(restaurant) }})</ng-container>
      </div>
      <h1 *ngIf="restaurant.disabled && restaurant.comebackDate === undefined" class="alert alert-danger">DISABLED</h1>
      <h1 *ngIf="restaurant.disabled && (restaurant.comebackDate === null || isDate(restaurant.comebackDate))"
        class="alert alert-danger">TEMPORARILY DISABLED</h1>
    </q-banner>
  </div>
</div>

<div *ngIf="restaurant && readonly">
  <app-restaurant-profile [restaurant]="restaurant"></app-restaurant-profile>
</div>

<div *ngIf="restaurant && !readonly">
  <div class="p-t-1 pt-1 p-b-1 pb-1 row">
    <div class="col-2">
      <button (click)="toggleTextReply()" class="btn btn-secondary fa fa-comments"> Send Text Message</button>
    </div>
    <div class="col-10 text-right">
      <select [(ngModel)]="languageType" class="language-select mr-3 col-2" style="min-width:180px;max-width:180px;"
        (change)="changeLanguage()">
        <option *ngFor="let type of languageTypes" [value]="type.value">{{type.text}}</option>
      </select>
      <span class="ml-2 mr-2">Explanations</span>
      <q-toggle [(ngModel)]="showExplanations" (change)="toggleShowExplanations()" class="mr-2"></q-toggle>
      <button class="btn btn-primary ml-2" (click)="diagnose()"><i class="fas fa-stethoscope"></i> Diagnose</button>
    </div>
  </div>
  <!-- start with show warning data -->
  <div class="row alert alert-danger m-1 p-1" style="border-radius:2px;" *ngIf="getWarningData()">
    {{getWarningData()}}
  </div>
  <!-- end with show warning data -->
  <div>
    <q-modal #textReplyModal>
      <button type="button" class="close" (click)="closeTextReply()">
        <span>Ã—</span>
      </button>
      <h4 class="text-center">Send Text Message</h4>
      <hr>
      <app-send-text-reply #textReplyComponent [restaurant]="restaurant"></app-send-text-reply>
    </q-modal>
  </div>

  <div class="card">
    <div class="card-header">
      <ul class="nav nav-tabs card-header-tabs">
        <li class="nav-item" *ngFor="let tab of tabs">
          <a *ngIf="tab === 'Menus' " class="nav-link {{activeTab === tab? 'active' : ''}}" (click)="setActiveTab(tab)"
            style="cursor: pointer;">{{tab}} ({{restaurant?.menus?.length || 0}})</a>
          <a *ngIf="tab === 'Menu Options'" class="nav-link {{activeTab === tab? 'active' : ''}}"
            (click)="setActiveTab(tab)" style="cursor: pointer;">{{tab}} ({{restaurant?.menuOptions?.length || 0}})</a>
          <a *ngIf="tab === 'Coupons'" class="nav-link {{activeTab === tab? 'active' : ''}}" (click)="setActiveTab(tab)"
            style="cursor: pointer;">{{tab}} ({{restaurant?.promotions?.length || 0}})</a>
          <a *ngIf="tab != 'Menus' && tab != 'Menu Options' && tab != 'Coupons' "
            class="nav-link {{activeTab === tab? 'active' : ''}}" (click)="setActiveTab(tab)"
            style="cursor: pointer;">{{tab}} <ng-container *ngIf="tab === 'Logs'">({{restaurant?.logs?.length || 0}})
            </ng-container></a>
        </li>
      </ul>
    </div>
    <div class="card-body">

      <div *ngIf="activeTab === 'Menus'">
        <app-menus [restaurant]="restaurant" (onVisitMenuOptions)="activeTab = 'Menu Options'"
          (menusChanged)="loadDetails()"></app-menus>
      </div>

      <div *ngIf="activeTab === 'Menu Options'">
        <app-menu-options [restaurant]="restaurant"></app-menu-options>
      </div>

      <div *ngIf="activeTab === 'Coupons'">
        <app-restaurant-promotions [restaurant]="restaurant"></app-restaurant-promotions>
      </div>

      <div *ngIf="activeTab === 'Invoices'">
        <app-restaurant-invoices [restaurant]="restaurant"></app-restaurant-invoices>
      </div>

      <div *ngIf="activeTab === 'Orders'">
        <app-restaurant-orders [restaurant]="restaurant"></app-restaurant-orders>
      </div>

      <div *ngIf="activeTab === 'GMB'">
        <app-restaurant-gmb [restaurant]="restaurant"></app-restaurant-gmb>
      </div>

      <div class="row mt-4" *ngIf="activeTab === 'Settings'">
        <div class="col-xl-6" *ngIf="isSectionVisible('profile')">
          <app-restaurant-profile [restaurant]="restaurant" #restaurantProfile [users]="knownUsers" [editable]="true">
          </app-restaurant-profile>
        </div>
        <div class="col-xl-6" *ngIf="isSectionVisible('webSettings')">
          <app-email-code-reader [restaurant]="restaurant"></app-email-code-reader>
        </div>
        <div class="col-xl-6" *ngIf="isSectionVisible('restaurantManagedWebSettings')">
          <app-restaurant-web-settings [restaurant]="restaurant"></app-restaurant-web-settings>
        </div>
        <div class="col-xl-6" *ngIf="isSectionVisible('serviceSettings')">
          <app-restaurant-service-settings [restaurant]="restaurant"></app-restaurant-service-settings>
        </div>
        <div class="col-xl-6" *ngIf="isSectionVisible('qrSettings')">
          <app-restaurant-qr-settings [restaurant]="restaurant"></app-restaurant-qr-settings>
        </div>
        <div class="col-xl-6" *ngIf="isSectionVisible('closedHours')">
          <app-restaurant-closed-hours [restaurant]="restaurant"></app-restaurant-closed-hours>
        </div>
        <div class="col-xl-6" *ngIf="isSectionVisible('deliverySettings')">
          <app-restaurant-delivery-settings [restaurant]="restaurant"></app-restaurant-delivery-settings>
        </div>
        <div class="col-xl-6" *ngIf="isSectionVisible('promotions')">
          <app-restaurant-promotions [restaurant]="restaurant"></app-restaurant-promotions>
        </div>

        <div class="col-xl-6" *ngIf="isSectionVisible('cloudPrinting')">
          <app-cloud-printing-settings [restaurant]="restaurant"></app-cloud-printing-settings>
        </div>

        <div class="col-xl-6" *ngIf="isSectionVisible('faxSettings')">
          <app-restaurant-fax-settings [restaurant]="restaurant"></app-restaurant-fax-settings>
        </div>

        <div class="col-xl-6" *ngIf="isSectionVisible('contacts')">
          <app-restaurant-contacts [restaurant]="restaurant"></app-restaurant-contacts>
        </div>

        <div class="col-xl-6" *ngIf="isSectionVisible('paymentMeans') || isMarketerAndCreatedLessThan14Days()">
          <app-restaurant-payment-means [restaurant]="restaurant"></app-restaurant-payment-means>
        </div>
        <div class="col-xl-6" *ngIf="isSectionVisible('feeSchedules') && restaurant.feeSchedules">
          <app-restaurant-sales [restaurant]="restaurant" [users]="knownUsers"></app-restaurant-sales>
          <app-restaurant-fee-schedules [restaurant]="restaurant" [users]="knownUsers"></app-restaurant-fee-schedules>
        </div>
        <div class="col-xl-6" *ngIf="isSectionVisible('rateSchedules') && !restaurant.feeSchedules">
          <app-restaurant-rate-schedules [restaurant]="restaurant" [users]="knownUsers"></app-restaurant-rate-schedules>
        </div>
        <div class="col-xl-6" *ngIf="isSectionVisible('restaurantChains')">
          <app-restarant-chains [restaurant]="restaurant"></app-restarant-chains>
        </div>
      </div>

      <div *ngIf="activeTab === 'Logs'">
        <app-restaurant-logs [restaurant]="restaurant" (reload)="reload($event)"></app-restaurant-logs>
      </div>
      <!-- start with IVR -->
      <div *ngIf="activeTab === 'IVR'">
        <app-restaurant-ivr-list [restaurant]="restaurant"></app-restaurant-ivr-list>
      </div>
      <!-- end with IVR -->
      <div *ngIf="activeTab === 'Tasks'">
        <app-restaurant-tasks [restaurant]="restaurant"></app-restaurant-tasks>
      </div>

      <div *ngIf="activeTab === 'Diagnostics'">
        <app-restaurant-diagnostics [restaurant]="restaurant"></app-restaurant-diagnostics>
      </div>

      <div *ngIf="activeTab === 'Others'">
        <app-restaurant-others [restaurant]="restaurant"></app-restaurant-others>
      </div>

    </div>
  </div>
</div>