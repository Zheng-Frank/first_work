<div class="card-group">
  <div class="card mb-2">
    <h3 class="card-title text-center pt-4 pb-2">
      <i class="far fa fa-car"></i> Delivery Settings
    </h3>
    <ul class="list-group list-group-flush">

      <li class="list-group-item">
        <!-- <div class="text-right py-2">
          <span>{{postmatesAvailability}} </span>

            <div *ngIf="postmatesAvailability == 'Not available'">
              <i class="fa fa-times text-danger" aria-hidden="true"></i>
            </div>

          <div *ngIf="postmatesAvailability && postmatesAvailability.indexOf('Available') >= 0">
            <i class="fa fa-check fg--green" aria-hidden="true"></i>
          </div>
          <button class="btn btn-link py-0 pr-0" (click)="checkPostmatesAvailability()"
          [qLoading]="checkingPostmatesAvailability">Check Postmates availability</button>

        </div> -->


        <div class="row mt-3" *ngIf="!readonly">
          <button class="btn btn-link py-0 mr-3" (click)="checkPostmatesAvailability()"
            [qLoading]="checkingPostmatesAvailability">Check Postmates availability</button>
          <div *ngIf="postmatesAvailability && postmatesAvailability.indexOf('Available') >= 0; else notAvailable">
            <i class="fa fa-check fg--green" aria-hidden="true"></i>
            <span>{{postmatesAvailability}}</span>
          </div>
          <ng-template #notAvailable>
            <div *ngIf="postmatesAvailability == 'Not available'">
              <i class="fa fa-times text-danger" aria-hidden="true"></i>
              <span>Not available</span>
            </div>
          </ng-template>
        </div>
        <!--displaying-->
        <div *qIf="!editing">

          <table class="app-table w-100">
            <tr>
              <th class="text-left">Courier:</th>
              <td class="pl-1">
                <strong>{{restaurant.courier?.name || "Self delivery"}}</strong>
                <img *ngIf="restaurant.courier?.name === 'Postmates'" src="./assets/images/postmates.png"
                  style="height: 2rem">
              </td>
            </tr>
            <tr *ngIf="restaurant.courier?.name === 'Postmates'">
              <th class="text-left">Notifications (订单通知):</th>
              <td class="pl-1">
                <div *ngIf="!restaurant.muteFirstNotifications">first round (第一轮)</div>
                <div *ngIf="!restaurant.muteSecondNotifications">second round (第二轮)</div>
              </td>
            </tr>
            <tr>
              <th class="text-left">Taxable:</th>
              <td class="pl-1">{{restaurant.taxOnDelivery ? 'Yes' : 'No'}}</td>
            </tr>
            <ng-container *ngIf="!restaurant.courier">
              <!--add block-->
              <tr *ngIf="restaurant.blockedCities && restaurant.blockedCities.length > 0">
                <th class="text-left">Blocked Cities:</th>
                <td class="pl-1">{{restaurant.blockedCities}}</td>
              </tr>
              <!--end add bolck-->
              <!--add block-->
              <tr *ngIf="restaurant.blockedZipCodes && restaurant.blockedZipCodes.length > 0">
                <th class="text-left">Blocked Zip Codes:</th>
                <td class="pl-1">{{restaurant.blockedZipCodes}}</td>
              </tr>
              <tr *ngIf="restaurant.allowedCities && restaurant.allowedCities.length > 0">
                <th class="text-left">Allowed Cities:</th>
                <td class="pl-1">{{restaurant.allowedCities}}</td>
              </tr>
              <tr *ngIf="restaurant.allowedZipCodes && restaurant.allowedZipCodes.length">
                <th class="text-left">Allowed Zip Codes:</th>
                <td class="pl-1">{{restaurant.allowedZipCodes}}</td>
              </tr>

              <!--end add bolck-->
              <ng-container *ngIf="!hasDeliveryHours()">
                <tr *ngIf="restaurant.deliveryFromTime">
                  <th class="text-left">Start Time:
                    <i class="fa fa-info-circle icon-color" (mouseover)="showExplanation = true"
                      (mouseout)="showExplanation = false">
                      <div *ngIf="showExplanation" class="left talk radius">
                        <p>NOTE: Start and end time refer to the first and last moment at which the restaurant can
                          deliver the food to the customer.</p>
                        -------------<br>
                        <p>请注意：开始和结束时间是指餐厅能将外卖送达到顾客手里的最早时间和最晚时间。</p>
                      </div>
                    </i>
                  </th>
                  <td class="pl-1">
                    {{restaurant.deliveryFromTime | adjustedDate : 'h:mm a' : restaurant.googleAddress.timezone}}
                  </td>
                </tr>
                <tr *ngIf="!restaurant.deliveryFromTime">
                  <th class="text-left">Start Time:
                    <i class="fa fa-info-circle icon-color" (mouseover)="showExplanation = true"
                      (mouseout)="showExplanation = false">
                      <div *ngIf="showExplanation" class="left talk radius">
                        <p>NOTE: Start and end time refer to the first and last moment at which the restaurant can
                          deliver the food to the customer.</p>
                        -------------<br>
                        <p>请注意：开始和结束时间是指餐厅能将外卖送达到顾客手里的最早时间和最晚时间。</p>
                      </div>
                    </i>
                  </th>
                  <td class="pl-1">
                    At business open
                  </td>
                </tr>
                <tr>
                  <th class="text-left">End Time:</th>
                  <td class="pl-1">{{getDeliveryEndString()}}</td>
                </tr>
              </ng-container>
              <tr>
                <th class="text-left">Delivery Open Hours:</th>
                <td>
                  <div class="text-left">
                    <lib-hours-viewer [timezone]="restaurant.googleAddress.timezone"
                      [hours]="restaurant.deliveryHours || []"></lib-hours-viewer>
                  </div>
                </td>
              </tr>
            </ng-container>

          </table>

          <table class="table app-borderless w-100"
            *ngIf="!restaurant.courier && restaurant.deliverySettings && restaurant.deliverySettings.length > 0">
            <thead>
              <tr>
                <th class="text-center">Distance (mile)</th>
                <th class="text-center">Order Minimum</th>
                <th class="text-center">Charge</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let ds of restaurant.deliverySettings">
                <td class="text-center">{{ds.distance}}</td>
                <td class="text-center">{{(ds.orderMinimum || 0) | money}}</td>
                <td class="text-center">{{(ds.charge || 0) | money}}</td>
              </tr>
            </tbody>
          </table>
          <ng-container *ngIf="!restaurant.courier && restaurant.deliveryArea">
            <div class="form-group">
              <div><label style="font-size: small">Delivery Area</label></div>
              <div class="row"><a class="btn btn-link" (click)="showAreaTip = !showAreaTip">{{showAreaTip ? 'Hide': 'Show'}} more</a></div>
              <div *ngIf="showAreaTip">Enter the latitude/longitude coordinates of the shape that defines the delivery area for this restaurant. Follow the instructions in this document: <a target="_blank" href="https://docs.google.com/document/d/1FLJhzS1cRoeoZKdDfKVNzZvxT4-PfESWP8ZMC6XzmBY/edit?usp=sharing">https://docs.google.com/document/d/1FLJhzS1cRoeoZKdDfKVNzZvxT4-PfESWP8ZMC6XzmBY/edit?usp=sharing</a></div>
            </div>
            <div class="form-group row" >
              <div class="col-5 col-form-label pt-0">
                <div id="delivery-map"></div>
              </div>
              <div class="col-7 text-left">
                <div class="form-group">
                  <textarea class="form-control" rows="9" [(ngModel)]="restaurant.deliveryArea" disabled></textarea>
                </div>
              </div>
            </div>
          </ng-container>


          <app-restaurant-delivery-closed-hours [readonly]="readonly" [restaurant]="restaurant" *ngIf="!restaurant.courier">
          </app-restaurant-delivery-closed-hours>

        </div>

        <!--editing-->
        <div *qIf="editing">
          <table class="w-100">
            <tr>
              <th class="text-left">
                <label for="courier-select">Courier</label>
              </th>
              <td class="pl-1">
                <div class="form-group">
                  <select class="form-control" id="courier-select" [(ngModel)]="selectedCourier">
                    <option *ngFor="let c of couriers" [ngValue]="c" [disabled]="deliveryAndNotQMenuCollect(c)">
                      {{c.name}}</option>
                  </select>
                </div>
              </td>
            </tr>

            <tr *ngIf="selectedCourier && selectedCourier.name === 'Postmates'">
              <th class="text-left">First Round Notifications(第一轮通知)</th>
              <td class="pl-1">
                <label class="switch">
                  <input type="checkbox" (click)="toggleFirstNotifications()" [checked]="firstNotifications">
                  <div class="slider round"></div>
                </label>
              </td>
            </tr>

            <tr *ngIf="selectedCourier && selectedCourier.name === 'Postmates'">
              <th class="text-left">Second Round Notifications(第二轮通知)</th>
              <td class="pl-1">
                <label class="switch">
                  <input type="checkbox" (click)="toggleSecondNotifications()" [checked]="secondNotifications">
                  <div class="slider round"></div>
                </label>
              </td>
            </tr>

            <tr>
              <th class="text-left">Taxable</th>
              <td class="pl-1">
                <label class="switch">
                  <input type="checkbox" (click)="toggleTaxOnDelivery()" [checked]="taxOnDelivery">
                  <div class="slider round"></div>
                </label>
              </td>
            </tr>
            <ng-container *ngIf="selectedCourier?.name === 'Self delivery'">
              <tr>
                <th class="text-left">Blocked Cities</th>
                <td class="pl-1">
                  <input type="text" [(ngModel)]="blockedCities" class="form-control">
                </td>
              </tr>
              <tr>
                <th class="text-left">Blocked Zip Codes</th>
                <td class="pl-1">
                  <input type="text" [(ngModel)]="blockedZipCodes" class="form-control">
                </td>
              </tr>
              <tr>
                <th class="text-left">Allowed Cities</th>
                <td class="pl-1">
                  <input type="text" [(ngModel)]="allowedCities" class="form-control">
                </td>
              </tr>
              <tr>
                <th class="text-left">Allowed Zip Codes</th>
                <td class="pl-1">
                  <input type="text" [(ngModel)]="allowedZipCodes" class="form-control">
                </td>
              </tr>
              <tr>
                <th class="text-left">Start Time</th>
                <td class="pl-1">
                  <select [(ngModel)]="deliveryFrom" class="form-control">
                    <option *ngFor="let t of deliveryFromTimes" [ngValue]="t">{{t.text}}</option>
                  </select>
                </td>
              </tr>
              <tr>
                <th class="text-left">End Time</th>
                <td class="pl-1">
                  <select [(ngModel)]="deliveryEndMinutesBeforeClosing" class="form-control">
                    <option *ngFor="let t of deliveryEndTimes" [ngValue]="t.value">{{t.text}}</option>
                  </select>
                </td>
              </tr>
              <tr>
                <th class="text-left">Delivery Open Hours</th>
                <td class="pl-1">
                  <div *ngFor="let hour of deliveryHours">
                    {{hour.fromTime | adjustedDate : 'E h:mm a' : restaurant.googleAddress.timezone}}
                    - {{hour.toTime | adjustedDate : 'h:mm a' : restaurant.googleAddress.timezone}}
                    <button type="button" class="btn btn-link text-danger py-0" (click)="deleteHour(hour)"><i
                        class="fas fa-trash-alt"></i></button>
                  </div>
                  <div>
                    <button type="button" class="btn btn-link" (click)="clickedAddHour = !clickedAddHour">+ Add
                      Hours</button>
                  </div>

                  <div *qIf="clickedAddHour" class="alert alert-secondary mt-2" style="font-size: smaller">
                    <lib-hours-picker (cancel)="clickedAddHour = false" (submit)="doneAddingHour($event)"
                      [timezone]="restaurant.googleAddress.timezone">
                    </lib-hours-picker>
                  </div>
                </td>
              </tr>
            </ng-container>
          </table>

          <table class="table app-borderless w-100" *ngIf="selectedCourier?.name === 'Self delivery'">
            <thead>
              <tr>
                <th class="text-center">Distance (mile)</th>
                <th class="text-center">Order Minimum</th>
                <th class="text-center">Charge</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let ds of deliverySettingsInEditing">
                <td class="text-center">
                  <input type="number" class="form-control" [(ngModel)]="ds.distance">
                </td>
                <td class="text-center">
                  <input type="number" class="form-control" [(ngModel)]="ds.orderMinimum">
                </td>
                <td class="text-center">
                  <input type="number" class="form-control" [(ngModel)]="ds.charge">
                </td>
              </tr>
              <tr>
            </tbody>
          </table>

          <ng-container *ngIf="selectedCourier?.name === 'Self delivery'">
            <div class="form-group">
              <div><label style="font-size: small">Delivery Area</label></div>
              <div class="row"><a class="btn btn-link" (click)="showAreaTip = !showAreaTip">{{showAreaTip ? 'Hide': 'Show'}} more</a></div>
              <div *ngIf="showAreaTip">Enter the latitude/longitude coordinates of the shape that defines the delivery area for this restaurant. Follow the instructions in this document: <a target="_blank" href="https://docs.google.com/document/d/1FLJhzS1cRoeoZKdDfKVNzZvxT4-PfESWP8ZMC6XzmBY/edit?usp=sharing">https://docs.google.com/document/d/1FLJhzS1cRoeoZKdDfKVNzZvxT4-PfESWP8ZMC6XzmBY/edit?usp=sharing</a></div>
            </div>
            <div class="form-group row">
              <div class="col-4"></div>
              <div class="col-8 text-left">
                <div *qIf="editing" class="form-group">
                  <textarea class="form-control" rows="5" [(ngModel)]="deliveryArea"></textarea>
                  <div *ngIf="!deliveryAreaValid()" class="text-danger">Format invalid. Please enter a self-closing array longitude/latitude coordinates of the delivery area or a valid geojson shape</div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </li>

      <li class="list-group-item text-right" *ngIf="!editing && !readonly">
        <button (click)="toggleEditing()" class="btn btn-primary" role="button">Edit</button>
      </li>
      <li class="list-group-item text-right" *ngIf="editing">
        <button class="btn btn-secondary" (click)="toggleEditing()" style="min-width: 6rem">Cancel</button>
        <button class="btn btn-primary" [disabled]="!deliveryAreaValid()" (click)="update()" style="min-width: 6rem">OK</button>
      </li>
    </ul>
  </div>
</div>
