<div>
  <h2>View IRS Form 1099-K for {{restaurant.name}}</h2>
  <button class="btn btn-link"
    (click)="showExplanation = !showExplanation">{{!showExplanation ? 'Show Explanation' : 'Hide Explanation'}}</button>
  <p *ngIf="showExplanation">
    Two copies of Form 1099-K will be generated for a restaurant for each year that the form is needed, in January of
    the following year. We must provide the restaurant with one copy for them to submit to the IRS, as well as submit
    another copy to the IRS on their behalf. For tax years 2020 and 2021, Qmenu must have collected at least $20,000 and
    processed at least 200 transactions for a restaurant to necessitate Form 1099-K for that year. For tax year 2022
    onward, Qmenu must have collected $600 or more for a restaurant to necessitate a Form 1099-K.
  </p>
  <hr>
  <!-- start with Payee/TIN/Email Attributes -->
  <div class="row ml-2">
    <div>
      <b>TIN: </b>
      <b class="text-danger" *ngIf="!restaurant.tin">Attribute Missing</b>
      <q-edit-label [value]="restaurant.tin" (edit)="onEdit($event, 'rtTIN')">
      </q-edit-label>
    </div>
    <div class="mx-2">
      <b>Payee: </b>
      <b class="text-danger" *ngIf="!restaurant.payeeName">Attribute Missing</b>
      <q-edit-label [value]="restaurant.payeeName" (edit)="onEdit($event, 'payeeName')">
      </q-edit-label>
    </div>
    <div class="mx-2">
      <b>Email: </b>
      <span *ngIf="emails.length > 0; else elseBlockEmail">{{emails.join(', ')}} </span>
      <ng-template #elseBlockEmail>
        <b class="text-danger">Attribute Missing</b>
        <q-edit-label [emptyHint]="'(click to add)'" [value]="" [type]="'text'" (edit)="onEdit($event, 'Email')">
        </q-edit-label>
      </ng-template>
    </div>
  </div>
  <!-- end with Payee/TIN/Email Attributes -->
  <p><br> Please be patient. Downloading maybe take some time. </p>
  <!-- start with 1099k form list -->
  <ul>
    <ng-container *ngFor="let linkEntry of formLinks">
      <li *ngIf="linkEntry[0]; else elseBlock">
        <ng-container *ngIf="linkEntry[0].required; else requiredBlock">
          {{linkEntry[1]}} - 
          <ng-container *ngIf="allAttributesPresent(); else missingAttributesBlock">
            <a class="btn-link" (click)="renderPDFForm('qmenu',linkEntry[1])"> for qMenu
              <i class="fa fa-download"></i></a>
            <a class="btn-link ml-2" (click)="renderPDFForm('restaurant',linkEntry[1])"> for Restaurant
              <i class="fa fa-download"></i></a>
            <a class="btn-link ml-2" (click)="openSendEmailModal(linkEntry[1])">Send</a>
            <span *ngIf="linkEntry[0].sent" class="text-success">
              (Sent)
            </span>
          </ng-container>
          <ng-template #missingAttributesBlock>
            <span class="text-danger">
              Fill in all missing attributes to enable file download.
            </span>
          </ng-template>
        </ng-container>
        <ng-template #requiredBlock>
          {{linkEntry[1]}} - No Form Required for this year
        </ng-template>
      </li>
      <ng-template #elseBlock>
        <li>
          <button class="btn btn-link" (click)="calculateForm1099k(linkEntry[1])">Calculate 1099K</button>
        </li>
      </ng-template>
    </ng-container>
  </ul>
  <!-- end with 1099k form list -->
  <!-- start with send emails modal -->
  <q-modal #sendEmailModal [size]="'lg'">
    <button type="button" class="close" (click)="sendEmailModal.hide()">
      <span>Ã—</span>
    </button>
    <h4 class="text-center">Send PDF Form</h4>
    <hr>
    <!-- start with email channels -->
    <div *ngIf="allEmails.length > 0">
      <div *ngFor="let email of allEmails">
        <input type="checkbox" (change)="selectTarget($event, email)" [value]="email.value"
          [checked]="targets.includes(email)">
        <i class="fas fa-envelope-square"></i>
        {{email.value}}
        <ng-container *ngIf="email.notifications?.length">({{email.notifications?.join("/")}})</ng-container>
      </div>
    </div>
    <div *ngIf="allEmails.length <= 0">
      No message target found, please add the contact you need to the RT's contacts.
    </div>
    <!-- end with email channels -->
    <!-- template has some input varible to fill in -->
    <div *ngIf="template">
      <div class="mt-2" *ngFor="let field of template.inputs">
        <label>{{field.label}}<span class="text-danger">*</span></label>
        <input class="form-control" type="{{field.type || 'text'}}" [(ngModel)]="field.value">
      </div>
      <div class="msg-content mt-2" [innerHTML]="sanitized(template.html)"></div>
    </div>
    <div class="d-flex justify-content-end p-4">
      <button class="btn btn-secondary mr-2" (click)="sendEmailModal.hide()">Cancel</button>
      <button class="btn btn-primary" (click)="sendPDFFormToRT()" [qLoading]="sendLoading">Send</button>
    </div>
  </q-modal>
  <!-- end with send email modal -->
</div>
