<div class="card mb-2">
  <h3 class="card-title text-center pt-4 pb-2">
    <i class="fas fa-chart-pie"></i> Fee Schedules</h3>
  <table class="table table-borderless table-striped table-sm">
    <thead>
      <tr>
        <th>Assessment</th>
        <th>Payer → Payee</th>
        <th>Conditions</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let feeSchedule of feeSchedules"
        class="{{feeSchedule.toTime && feeSchedule.toTime.valueOf() < now.valueOf() ? 'expired' : '' }} ">

        <td class="text-nowrap">
          <div *ngIf="feeSchedule.name">{{feeSchedule.name}}</div>
          <div *ngIf="feeSchedule.monthlyAmount" class="my-text-b">
            {{feeSchedule.monthlyAmount |currency:'USD':'symbol'}}
          </div>
          <div *ngIf="feeSchedule.rate || feeSchedule.amount" class="my-text-b">
            <span *ngIf="feeSchedule.rate">{{feeSchedule.rate | percent }}</span>
            <span *ngIf="feeSchedule.rate && feeSchedule.amount"> + </span>
            <span *ngIf="feeSchedule.amount">{{feeSchedule.amount |currency:'USD':'symbol'}}</span>
          </div>
          <div class="my-text-small text-muted">
            {{chargeBasisMap[feeSchedule.chargeBasis]}}
          </div>
        </td>
        <td class="text-lowercase text-nowrap">{{feeSchedule.payer}} → {{feeSchedule.payee}}
          <div class="my-text-small">
            {{ feeSchedule.fromTime | date: 'shortDate' }} → <span
              *ngIf=" feeSchedule.toTime">{{ feeSchedule.toTime | date: 'shortDate' }}</span>
          </div>
        </td>

        <td>
          <div *ngIf="feeSchedule.orderTypes && feeSchedule.orderTypes.length > 0" class="text-lowercase">
            {{feeSchedule.orderTypes.join(', ')}}
          </div>

          <div *ngIf="feeSchedule.orderPaymentMethods && feeSchedule.orderPaymentMethods.length > 0"
            class="text-lowercase">
            {{feeSchedule.orderPaymentMethods.join(', ')}}
          </div>
        </td>

        <td>
          <button class="btn btn-link p-0" (click)="edit(feeSchedule)">Edit</button>
        </td>
      </tr>
      <tr>
        <td colspan="4">
          <button class="btn btn-link px-0" (click)="edit()">+ Add New</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<q-modal #modalFeeSchedule>
  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
    <span aria-hidden="true">×</span>
  </button>
  {{feeScheduleInEditing | json}}
  <q-form-builder [object]="feeScheduleInEditing" [showDelete]="feeScheduleInEditing.createdAt"
    [fieldDescriptors]="fieldDescriptors" (submit)="submit($event)" (cancel)="cancel($event)" (remove)="remove($event)">

    <div class="form-group" *ngIf="feeScheduleInEditing.chargeBasis === 'ORDER_SUBTOTAL'">
      <label>order related</label>
    </div>

    <div class="form-group" *ngIf="feeScheduleInEditing.chargeBasis === 'MONTHLY'">
      <label>Monthly</label>
    </div>
    <div class="form-group" *ngIf="feeScheduleInEditing.chargeBasis === 'COLLECTED_INVOICE_COMMISSION'">
      <label>commission</label>
    </div>

  </q-form-builder>
</q-modal>