<div *ngIf="orders">
  <div class="row">
    <label class="col-2 text-center pl-4"
      style="line-height: 35px; vertical-align: center;min-width:200px;max-width:200px;"> Search order by:
    </label>
    <select [(ngModel)]="type" class="form-control mr-3 col-2" style="min-width:180px;max-width:180px;">
      <option *ngFor="let type of searchTypes" [value]="type">{{type}}</option>
    </select>
    <input [qDebounce]="2000" (debounce)="search($event)" type="text" [(ngModel)]="searchText"
      class="form-control col-7" placeholder="Search">
    <div *ngIf="searchText" class="text-muted float-left col-1">Found: {{orders.length}}</div>
  </div>
  <div class="form-group">
    <button type="button" class="btn btn-link ml-3" (click)="showAdvancedSearch = !showAdvancedSearch">
     {{ showAdvancedSearch?'Hide advanced search..':'Show advanced search..'}}</button>
    <div class="alert alert-secondary my-mb-huge mt-2" *ngIf="showAdvancedSearch">
      <div class="row">
        <div class="col col-sm-6">
          <label>From:</label>
          <input class="form-control" type="date" [(ngModel)]="fromDate">
        </div>
        <div class="col col-sm-6">
          <label>To:</label>
          <input class="form-control" type="date" [(ngModel)]="toDate">
        </div>
      </div>
      <div class="row">
        <div class="text-right mt-1 col-12">
          <button type="button" class="btn btn-secondary" (click)="cancelDoSearchOrderByTime()">Cancel</button>
          <button class="btn btn-primary" (click)="doSearchOrderByTime(fromDate,toDate)">Submit</button>
        </div>
      </div>
    </div>
  </div>

  <div class="row ml-0 mr-0">
    <!-- row has negative margins and we need to remove them! -->
    <div *ngFor="let order of orders" class="col-sm-12 col-md-6 col-lg-4  app-pl-025 app-pr-025 mb-1">
      <app-order-card [restaurant]="restaurant" [order]="order" (onSetNewStatus)="handleOnSetNewStatus($event)"
        (onReject)="handleOnReject($event)" (onUndoReject)="handleOnUndoReject($event)" (onBan)="handleOnBan($event)"
        (onDisplayCreditCard)="handleOnDisplayCreditCard($event)" (onAdjust)="handleOnAdjust($event)"
        (onOpenChangeOrderTypesModal)="handleOpenChangeOrderTypesModal($event)">
      </app-order-card>
    </div>
  </div>

   <!-- change order type q-modal to select two type of order type -->
   <q-modal #changeOrderTypeModal style="margin-top: 160px;">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">×</span>
    </button>
    <h4 class="text-center">Change Order Type</h4>
    <hr>
    <div class="container">
      <div class="row mb-3">
        <div class="col-12">
          <select [(ngModel)]="changeOrderType" class="form-control">
            <option value="Customer Pickup">Customer Pickup</option>
            <option value="Restaurant self-deliver">Restaurant self-deliver</option>
          </select>
        </div>
      </div>
    </div>
      <div class="d-flex justify-content-end p-4">
        <button class="btn btn-secondary mr-2" (click)="changeOrderTypeModal.hide()">Cancel</button>
        <button class="btn btn-primary" (click)="handleOnChangeOrderTypes()">Submit</button>
      </div>

  </q-modal>

        (onChangeToSelfDelivery)="handleOnChangeToSelfDelivery($event)" 
        (onOpenPreviousCanceledOrderModal)="handleOnOpenPreviousCanceledOrderModal($event)">

      </app-order-card>
    </div>
  </div>
  <!-- start previous canceled order q-modal -->
  <q-modal #previousCanceledOrderModal>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">×</span>
    </button>
    <h4 class="text-center">Previous Canceled Order</h4>
    <hr>
     <!-- row has negative margins and we need to remove them! -->
      <app-order-card [restaurant]="restaurant" [order]="previousCanceledOrder" (onSetNewStatus)="handleOnSetNewStatus($event)"
        (onReject)="handleOnReject($event)" (onUndoReject)="handleOnUndoReject($event)" (onBan)="handleOnBan($event)"
        (onDisplayCreditCard)="handleOnDisplayCreditCard($event)" (onAdjust)="handleOnAdjust($event)"
        (onChangeToSelfDelivery)="handleOnChangeToSelfDelivery($event)">

      </app-order-card>
  </q-modal>
  <!-- end previous canceled order q-modal -->
  <q-modal #paymentModal>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">×</span>
    </button>
    <div class="clearfix"></div>
    <hr>
    <p>{{payment.explanation}}</p>
    <table class="table-borderless">
      <tr>
        <th>Payment Type</th>
        <td>{{payment.paymentType}}</td>
      </tr>
      <tr *ngIf="payment.card">
        <th>Customer Name</th>
        <td>{{payment.card.firstName + ' ' + (payment.card.lastName || '')}}</td>
      </tr>
      <tr *ngIf="payment.card">
        <th>Card Number</th>
        <td>{{getFormattedCreditCardNumber(payment.card.cardNumber)}}</td>
      </tr>
      <tr *ngIf="payment.card">
        <th>Card Expiry</th>
        <td>{{payment.card.expiryMonth + '/' + payment.card.expiryYear}}</td>
      </tr>
      <tr *ngIf="payment.card">
        <th>Card CVC</th>
        <td>{{payment.card.cvc || 'N/A'}}</td>
      </tr>
      <tr *ngIf="payment.card && payment.card.zipcode">
        <th>Zip Code</th>
        <td>{{payment.card.zipcode || 'N/A'}}</td>
      </tr>
      <tr *ngIf="payment.card && payment.card.billingAddress && payment.card.billingAddress.place_id">
        <th>Billing Address</th>
        <td>
          {{payment.card.billingAddress?.apt}} {{payment.card.billingAddress?.formatted_address}}
        </td>
      </tr>
    </table>
    <button class="btn btn-lg btn-block btn-secondary" data-dismiss="modal">OK</button>
  </q-modal>

  <q-modal #rejectModal>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">×</span>
    </button>
    <h4 class="text-center">Reject Order</h4>
    <hr>
    <app-order-reject-bar [order]="orderForModal" (onReject)="rejectOrder($event)"></app-order-reject-bar>
    <hr>
    <div *ngIf="!!cancelError" class="d-flex flex-column align-items-center">
      <span class="text-primary">ATTENTION</span>
      <p class="text-primary">{{cancelError}}</p>
    </div>

    <div *ngIf="isPostmatesStatusDelivered" class="d-flex flex-column align-items-center">
      <span class="text-primary">ATTENTION</span>
      <p class="text-primary">Note that the Postmates status of this order <span
          class="font-weight-bold">delivered.</span><br />Please be sure you want to cancel it before proceeding. </p>
    </div>
  </q-modal>

  <q-modal #undoRejectModal>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">×</span>
    </button>
    <h4 class="text-center">Undo Reject Order</h4>
    <hr>
    <p class="text-center">Are you sure to undo cancel order?</p>
    <div class="d-flex justify-content-end p-4">
      <button class="btn btn-secondary mr-2" (click)="undoRejectModal.hide()">No</button>
      <button class="btn btn-primary" (click)="undoRejectOrder()">Yes</button>
    </div>

  </q-modal>

  <q-modal #banModal>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">×</span>
    </button>
    <h4 class="text-center">BAN CUSTOMER</h4>
    <hr>
    <div class="alert-danger">USE EXTREME CAUTION: The customer
      <b>{{orderForModal?.customer?.firstName}} {{orderForModal?.customer?.phone | tel}}</b> will be banned
      permanently
      from placing any orders in future!</div>
    <div class="alert-success mt-1 mt-1">Banned customers will NOT see the reasons.</div>

    <h5 class="pt-1 pb-1">Reasons (check all that applies)</h5>
    <app-ban-customer (onBan)="okBan($event)"></app-ban-customer>

  </q-modal>

  <q-modal #adjustModal>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">×</span>
    </button>
    <h4 class="text-center">Adjustment</h4>
    <hr>
    <app-order-adjustment (submit)="submitAdjustment($event)"></app-order-adjustment>
  </q-modal>

</div>
