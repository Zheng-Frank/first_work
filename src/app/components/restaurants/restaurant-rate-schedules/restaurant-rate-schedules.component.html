<div class="card mb-2">
  <h3 class="card-title text-center pt-4 pb-2">
    <i class="fas fa-percent"></i> Rate Schedules</h3>
  <div class="text-center">
    <button class="btn btn-link" *ngIf="!readonly" (click)="convertToFeeSchedules()">â†’ Convert to Fees Schedules</button>
  </div>
  <ul class="list-group list-group-flush">
    <li class="list-group-item">

      <!--displaying-->
      <div *qIf="!editing">

        <table class="table table-borderless table-sm"
          *ngIf="restaurant.rateSchedules && restaurant.rateSchedules.length > 0">
          <thead>
            <tr>
              <th>Date</th>
              <th>Order Type</th>
              <th>Rate</th>
              <th>Fixed</th>
              <th>Agent</th>
              <th *ngIf="!readonly">Commission</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let rs of restaurant.rateSchedules">
              <td>{{rs.date | date:'shortDate'}}</td>
              <td>{{rs.orderType || 'ALL'}}</td>
              <td>{{rs.rate | percentage}}</td>
              <td>{{rs.fixed | currency:'USD':'symbol'}}</td>
              <td>{{rs.agent}} <span *ngIf="isDisabled(rs.agent)" class="text-danger">*DISABLED*</span>
              </td>
              <td *ngIf="!readonly">{{rs.commission | percentage}}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!--editing-->
      <div *qIf="editing">

        <table class="table table-borderless table-sm">
          <thead>
            <tr>
              <th>Date</th>
              <th>Order Type</th>
              <th>Rate</th>
              <th>Fixed($)</th>
              <th>Sales Agent</th>
              <th>Agent's Commission</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let rs of rateSchedulesInEditing">
              <td>
                <input class="form-control" type="date" [(ngModel)]="rs.date">
              </td>
              <td>
                <select class="form-control" [(ngModel)]="rs.orderType" style="min-width: 6rem;">
                  <option>ALL</option>
                  <option>DELIVERY</option>
                  <option>PICKUP</option>
                  <option>DINE-IN</option>
                </select>
              </td>
              <td>
                <input class="form-control" type="number" [(ngModel)]="rs.rate" placeholder="eg. 0.04">
                <small class="text-danger" *ngIf="isRateInvalid('rate',rs.rate)">*** WARNING! Are you sure {{(100 * (rs.rate || 0)).toFixed(2)}}% is the correct value? ***</small>
              </td>
              <td>
                <input class="form-control" type="number" [(ngModel)]="rs.fixed" placeholder="eg. 0.99">
              </td>
              <td>
                <input class="form-control" type="text" [(ngModel)]="rs.agent">
              </td>
              <td>
                <input class="form-control" type="number" [(ngModel)]="rs.commission" placeholder="eg. 0.15">
                <small class="text-danger" *ngIf="isRateInvalid('commission',rs.commission)">*** WARNING! Are you sure {{(100 * (rs.commission || 0)).toFixed(2)}}% is the correct value? ***</small>
              </td>
            </tr>
            <tr>
          </tbody>
        </table>

        <div class="alert alert-info">
          <p><b>DO NOT remove valid historical fee schedules</b></p>
          <p><b>Rate: </b>percentage that qMenu charges restaurant for each order. Eg., input 0.04 for 4%</p>
          <p><b>Fixed: </b>dollar amount that qMenu charges restaurant for each order</p>

        </div>

        <div class="pt-1 text-right">
          <button class="btn btn-secondary" (click)="toggleEditing()" style="min-width: 6rem">Cancel</button>
          <button class="btn btn-primary" (click)="update()" style="min-width: 6rem">OK</button>
        </div>
      </div>

      <div class="text-right" *ngIf="!editing && !readonly">
        <button (click)="toggleEditing()" class="btn btn-primary" role="button">Edit</button>
      </div>
    </li>
  </ul>
</div>
