<div class="pt-2">
  <h1 class="text-center">
    IVR Logs
  </h1>
  <div class="my-text-small text-muted text-center">refreshed: {{lastRefreshed | ago : now}}</div>

  <div class="my-text-small text-muted text-center">
    {{ivrUsername || 'NOT LOGGED IN'}} | <span *ngFor="let phone of getMyPhones()">{{phone | tel}} | </span> {{getVisibleQueueNames().join(", ")}}
  </div>

  <div class="float-top-right pb-2 text-right">

    <button class="btn btn-primary ml-4" (click)="startIvr()"><i class="fas fa-headset"></i>
      Launch qMenu IVR</button>
    <button class="btn btn-primary ml-4" (click)="refreshCtrs()" [qLoading]="refreshing"><i class="fas fa-sync-alt"></i>
      Reload</button>
  </div>

  <div class="form-inline">
    <input [qDebounce]="500" (debounce)="filter($event)" type="text" class="form-control mr-4"
      placeholder="phone or restaurant ID" [(ngModel)]="searchFilter">

    <select (change)="filterQueue()" [(ngModel)]="selectedQueue" class="form-control mr-4">
      <option *ngFor="let q of queuesForFilter" [ngValue]="q">{{q.name || 'N/A'}}</option>
    </select>

    <label class="checkbox-inline"><input type="checkbox" [(ngModel)]="shouldCallbackOnly" (change)="filter()"
        class="mx-1"> Should
      callback</label>


  </div>

  <table class="table mt-2">
    <tr>
      <th>#</th>
      <th>Time</th>
      <th>Phone#</th>
      <th>Restaurant</th>
      <th>Queue</th>
      <th>Agent</th>
      <th>Recording</th>
      <th>Status</th>
    </tr>
    <tr *ngFor="let ir of filteredIvrRecords; let i = index" class="{{ir.shouldCallback ? 'alert-danger' : ''}}">
      <th>{{i + 1}}</th>
      <td>{{ir.initiatedAt | ago : now}}<br>
        <span class="my-text-small text-muted">{{ir.duration ? ir.duration + 's' : '-'}}</span>
      </td>
      <td class="text-nowrap"><strong>{{ir.customerEndpoint | tel}}</strong> <i *ngIf="!ir.inbound"
          class="fas fa-external-link-alt"></i>
        <div class="my-text-small text-muted">{{ir.ctrId}}</div>
      </td>
      <td class="text-nowrap">
        <div *ngFor="let rt of ir.restaurants" class="pb-1">
          <a routerLink="/restaurants/{{rt._id}}" target="_blank">{{rt.name}}</a>
          <div class="my-text-small text-muted">
            {{rt._id}}
          </div>
        </div>
      </td>
      <td>
        {{(ir.queueName || '').replace("chinese", "中文")}}
        <!-- <div *ngIf="(ir.queueName || '').toLowerCase().indexOf('chinese') >= 0 ; else notChinese">中文</div>
        <ng-template #notChinese>
          <div>{{ir.queueName}}</div>
          <div class="my-text-small text-muted">{{ir.systemEndpoint | tel}}</div>
        </ng-template> -->

      </td>
      <td>
        {{ir.agentUsername}}
      </td>
      <td>
        <audio controls *ngIf="ir.recordingMp3Url" preload="none">
          <source src="{{ir.recordingMp3Url}}" />
        </audio>
        <!-- <button class="btn btn-link py-0">
          <i *ngIf="ir.recordingMp3Url && !isMp3Visited(ir)" (click)="visitMp3(ir)" class="far fa-file-audio fa-2x"></i>
        </button> -->
      </td>
      <td>
        <div *ngIf="ir.shouldCallback">
          SHOULD CALLBACK
        </div>
      </td>
    </tr>
  </table>
</div>