<div class="card">
  <h2 class="card-title m-3">
    <h1 class="text-center">SMS Problems ({{filteredRows.length}})</h1>
  </h2>
  <div class="card-body">
    <div class="form-inline">
      <!-- start with to filter -->
      <select class="form-control my-2 mx-2" [(ngModel)]="toOption" (change)="filterRows()">
        <option *ngFor="let option of toOptions"> {{option}} </option>
      </select>
      <!-- end with to filter -->
      <!-- start with search input -->
      <input [qDebounce]="500" (debounce)="debounce($event)" type="text" class="form-control my-2 mx-2 search-input"
        placeholder="RT name or RT ID" [(ngModel)]="searchFilter">
      <!-- end with search input -->
      <!-- start with sms problem type -->
      <select class="form-control my-2 mx-2" [(ngModel)]="smsTypeOption" (change)="filterRows()">
        <option *ngFor="let option of smsTypeOptions"> {{option}} </option>
      </select>
      <!-- end with sms problem type -->
      <!-- start with pagination -->
      <input class="form-check-input" type="checkbox" [(ngModel)]="pagination">
      <label class="form-check-label mr-5">
        Pagination
      </label>
      <!-- end with pagination -->
    </div>
    <div class="row mx-1">
      <button type="button" class="btn btn-link" (click)="toggleShowAdvancedSearch()">
        {{ showAdvancedSearch?'Hide advanced search..':'Show advanced search..'}}</button>
    </div>
    <div class="form-inline mx-2" *ngIf="showAdvancedSearch">
      <!-- start with happened -->
      <select class="form-control my-2 mx-2" [(ngModel)]="happenedOption">
        <option *ngFor="let option of happenedOptions"> {{option}} </option>
      </select>
      <!-- end with happened -->
      <!-- start with custom date -->
      <ng-container *ngIf="happenedOption === happenedTypes.Custom_Range">
        <label class="ml-2">From:</label>
        <input class="form-control ml-1" type="date" [(ngModel)]="fromDate">
        <label class="ml-2">To:</label>
        <input class="form-control ml-1" type="date" [(ngModel)]="toDate">
      </ng-container>
      <button class="btn btn-primary ml-2" (click)="populateSMSProblems()">Search</button>
      <!-- end with custom date -->
    </div>

    <q-table [rows]="filteredRows" [tableColumnDescriptors]="myColumnDescriptors" [compact]="true"
      [pageSize]="pagination ? 100 : 100000">
      <tr *tableRowTemplate="let row;">
        <td>
          {{row.name}}
        </td>
        <td>
          <i class="fa fa-{{getTypeIcon(row.type.text)}}"></i>
          <div *ngIf="row.type.rtInfo">
            <a target="_blank" href="#/restaurants/{{row.type.rtInfo?._id}}">{{row.type.rtInfo?.name}}</a>
            <div><small>{{row.type.rtInfo?._id}}</small></div>
          </div>
        </td>
        <td>
          {{row.to}}
        </td>
        <td>
          {{row.createdAt | date:'yyyy-MM-dd HH:MM:SS'}}
        </td>
        <td>
          <button class="btn btn-link" (click)="showSMSProblemDetailModal(row.errorLogs)">Detail</button>
        </td>
      </tr>
    </q-table>
  </div>
  <!-- start with sms error detail modal -->
  <q-modal #SMSProblemDetailModal style="margin-top: 160px;">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">Ã—</span>
    </button>
    <h4 class="text-center">SMS Problem Detail</h4>
    <hr>
    <div class="container ml-5" *ngIf="smsEvent">
      <div class="row align-items-center">
        <label>Type:</label>
        <i class="fa fa-{{getTypeIcon(smsEvent?.type?.text)}} ml-2"></i>
        <div *ngIf="smsEvent?.type?.rtInfo" class="ml-2">
          <a target="_blank" href="#/restaurants/{{smsEvent.type.rtInfo._id}}">{{smsEvent.type.rtInfo.name}}</a>
          <div><small>{{smsEvent.type.rtInfo._id}}</small></div>
        </div>
        <div *ngIf="smsEvent?.type?.customerInfo" class="ml-2">
          <div>{{smsEvent.type.customerInfo.name}}</div>
          <div>{{smsEvent.type.customerInfo.email}}</div>
        </div>
      </div>
      <div class="row">
        <label>From Number:</label>
        <strong class="text-muted ml-1">{{smsEvent.fromNumber}}</strong>
      </div>
      <div class="row">
        <label>To Number:</label>
        <strong class="text-muted ml-1">{{smsEvent.toNumber}}</strong>
      </div>
      <div class="row">
        <label>Created At:</label>
        <strong class="text-muted ml-1">{{smsEvent.createdAt | date:'yyyy-MM-dd HH:MM:SS'}}</strong>
      </div>
      <div class="row">
        <label>Provider:</label>
        <strong class="text-muted ml-1">{{smsEvent.provider}}</strong>
      </div>
      <div class="row">
        <label>Current Provider:</label>
        <strong class="text-muted ml-1">{{smsEvent.currentProvider}}</strong>
      </div>
      <div class="row">
        <label>Error:</label>
        <strong class="text-muted ml-1">{{smsEvent.error}}</strong>
      </div>
    </div>
  </q-modal>
  <!-- end with sms error detail modal -->
</div>
