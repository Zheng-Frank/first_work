
<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
<h4 class="text-center">Create Invoice</h4>
<hr>

<h1 class="text-center">{{startDate | date:'MMMM y' }}</h1>
<div>
  <ng-container *ngFor="let state of invoiceStates">
    <label class="{{state.css}}" for="inlineFormCustomSelect">{{state.label}}</label>
    <select [(ngModel)]="state.value">
      <option value="any">any</option>
      <option value="yes">yes</option>
      <option value="no">no</option>
    </select> &nbsp;
  </ng-container>
  <label class="checkbox-inline"><input type="checkbox" [(ngModel)]="showCanceledRestaurant"> Show Canceled Restaurant</label> | 
  <label class="checkbox-inline"><input type="checkbox" [(ngModel)]="showRestaurantWithInvoiceOnly"> Show Restaurant With Invoice</label>
  <label class="checkbox-inline"><input type="checkbox" [(ngModel)]="showQmenuInvoiceOnly"> Show Qmenu Invoice</label>
</div>
<table class="table table-hover">
  <thead>
    <tr>
      <th role="button" class="text-primary" (click)="sort('name')">Restaurant <i class="fas fa-sort"></i></th>
      <th>Date Range</th>
      <th class="text-right">Total</th>
      <th class="text-right">Commission</th>
      <th class="text-right"></th>
      <th class="text-right">Invoice Option</th>
      <th role="button" class="text-primary text-right" (click)="sort('creditCardProcessingMethod')">Credit Card <i class="fas fa-sort"></i></th>
      <th colspan="3" class="text-right">Action</th>
    </tr>
  </thead>
  <tbody>
    <ng-container *ngFor="let record of restaurantInvoices;">
        
      <ng-container *ngIf="shouldShowQmenuRow(record)">
        <ng-container *ngIf="shouldShowInvoiceRow(record)">
        <!--display records-->
        <ng-container *ngFor="let invoice of getFilteredInvoices(record); let i = index">
          <tr *ngIf="shouldShowSubrow(invoice)" class="{{record.restaurant.disabled ? 'app-strike' : ''}}">
            <td *ngIf="i === 0" style="color: #292b2c" [attr.rowspan]="getFilteredInvoices(record).length"><a routerLink="/restaurant/{{record.restaurant.id }}">{{record.restaurant.name}}</a></td>
            <td class="text-nowrap" routerLink="/invoices/{{invoice.id}}" class="{{getCssClass(invoice)}}">&#9632; {{invoice.fromDate | date:'MMM d'}} - {{invoice.toDate | date:'MMM d'}}</td>
            <td class="text-right">{{invoice.getTotal() | currency:'USD':'symbol'}}</td>
            <td class="text-right">{{invoice.getCommission() | currency:'USD':'symbol'}}</td>
            <td class="text-right"></td>
            <!--invoice setting-->
            <td class="text-right text-nowrap">
            <!-- <div class="container-fluid">
              <div class="row">
                <div class="text-nowrap card">
                <div class="card-body">
                <h4 class="card-title"><a class="card-link text-primary" role="button" (click)="invoiceClicked(record.restaurant.id)">InvoiceDelivery</a>
                </h4>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="text-nowrap list-group-item">jk<span class="pull-right" >what</span></li>
                </ul>
              </div>
              </div>
            </div> -->
            </td>
            <td class="text-right">
              {{record.restaurant.creditCardProcessingMethod}}
            </td>
            <td class="text-right text-nowrap"><a routerLink="/invoices/{{invoice.id}}">Details</a> | <a class="text-primary" role="button" (click)="createClicked(record.restaurant.id)">Create</a></td>
          </tr>
        </ng-container>

        <!--there is no invoice, we still list the restaurant name-->
        <tr *ngIf="record.invoices.length === 0" class="{{record.restaurant.disabled ? 'app-strike' : ''}}">
          <td><a routerLink="/restaurant/{{record.restaurant.id }}">{{record.restaurant.name}}</a></td>
          <td colspan="3"></td>
          <td class="text-right"></td>
            <!--invoice setting-->
            <td class="text-right text-nowrap">
            <!-- <div class="container-fluid">
              <div class="row">
                <div class="text-nowrap card">
                <div class="card-body">
                <h4 class="card-title"><a class="card-link text-primary" role="button" (click)="invoiceClicked(record.restaurant.id)">InvoiceDelivery</a>
                </h4>
                </div>
                <ul class="list-group list-group-flush">
                    <li *ngIf="myInvoiceOptionEditor.fax" class="list-group-item">{{fax}}<span class="pull-right" ></span></li>
                    <li class="list-group-item">jk<span class="pull-right" >   whatcanidotogejlk</span></li>
                </ul>
              </div>
              </div>
            </div> -->
            </td>
          <!--td class="text-right"><a class="text-primary" role="button" (click)="invoiceClicked(record.restaurant.id)">InvoiceDelivery</a></td-->
          <td class="text-right">
            {{record.restaurant.creditCardProcessingMethod}}
          </td>
          <td class="text-right"><a class="text-primary" role="button" (click)="createClicked(record.restaurant.id)">Create</a></td>
        </tr>
        </ng-container>
      </ng-container>
    </ng-container>
    <tr>
        <th></th>
        <th>SUM</th>
        <th class="text-right">{{getTotal() | currency:'USD':'symbol':'1.2-2'}}</th>
        <th class="text-right">{{getCommission() | currency:'USD':'symbol':'1.2-2'}}</th>
        <th></th>
        <th></th>
    </tr>
  </tbody>
</table>

<q-modal #invoiceModal>
  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
  <h4 class="text-center">Create Invoice</h4>
  <hr>

  <app-invoice-editor #myInvoiceEditor (onNewInvoice)="createNewInvoice($event)" (onCancel)="invoiceModal.hide()"></app-invoice-editor>
</q-modal>

<q-modal #invoiceOptionModal>
  <button type="button" class="close" data-dismiss="modal" arial-label="Close"><span aria-hidden="true">×</span></button>
  <h4 class="text-center">Invoice Delivery Method</h4>
  <hr>
  
  <app-invoice-option-editor #myInvoiceOptionEditor (onInvoiceOption)="createInvoiceOption($event)" (onCancel)="invoiceOptionModal.hide()"></app-invoice-option-editor>
</q-modal>