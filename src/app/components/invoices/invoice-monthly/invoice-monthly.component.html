<h1 class="text-center">Monthly Invoices</h1>
<!-- <app-log-editor></app-log-editor> -->
<div class="clearfix">
  <div class="float-left form-inline">

  </div>
  <div class="float-right">
    <div class="pb-2">
      <button class="btn btn-primary" (click)="showFind = !showFind">
        <i class="fas fa-search"></i> Find Missing Invoices</button>
    </div>
  </div>
</div>

<div class="card text-left bg-light" *qIf="showFind">
  <div class="card-body">
    <div class="form-group row">
      <label for="to-date" class="col-4 col-form-label">To Date</label>
      <div class="col-8">
        <input class="form-control" id="to-date" type="date" [(ngModel)]="toDate">
      </div>
    </div>
    <div class="text-right mt-1">
      <button type="button" class="btn btn-secondary" (click)="showFind = false">Cancel</button>
      <button class="btn btn-primary" (click)="findMissingInvoices()" [qLoading]="apiRequesting">Submit</button>
    </div>

    <table>
      <tr>
        <th>Restaurant</th>
        <th>ID</th>
        <th>Overlapped</th>
        <th>Gapped</th>
        <th>Uninvoiced Orders</th>
        <th>Payment Methods</th>
      </tr>

      <tr *ngFor="let row  of rows" class="{{row.overlappedInvoices.length > 0 || row.gappedInvoices.length > 0 ? 'text-danger' : ''}} {{row.restaurant.disabled? 'app-muted' : ''}}">
        <td>
          {{row.restaurant.name}}
        </td>
        <td>
          <a target="_blank" href="#/restaurants/{{row.restaurant._id}}">{{row.restaurant._id}}</a>
        </td>
        <td>
          <span class="badge badge-danger mx-1" *ngFor="let i of row.overlappedInvoices">{{i.fromDate | date:
            "shortDate"}}</span>
        </td>
        <td>
          <span class="badge badge-danger mx-1" *ngFor="let i of row.gappedInvoices">{{i.fromDate | date:
            "shortDate"}}</span>
        </td>
        <td>
          {{row.orders.length}}
        </td>
        <td>
          {{row.paymentMethods}}
        </td>
      </tr>
    </table>

  </div>
</div>

<div *ngFor="let date of startDatesOfEachMonth" class="card text-center hvr-underline-reveal mx-1 mt-2" style="width: 20rem; display: inline-block; cursor: pointer;">
  <div class="card-body" routerLink="/invoices/monthly/{{date | date:'y-M-d'}}">
    <h4 class="card-title">{{date | date:'MMMM y' }}</h4>
  </div>
</div>
<div></div>