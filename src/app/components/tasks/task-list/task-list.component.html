<div *ngIf="!taskList || taskList.length === 0">
    List is empty
</div>
<q-simple-radio [(ngModel)]="selectedTaskName" [values]="taskNames" (ngModelChange)="selectTask($event)">
</q-simple-radio>
<div class="float-left form-inline mt-2">
    <label class="mr-2"> Count:</label>
    <span class="mr-5"> {{filteredTasks.length}} </span>

    <label class="mr-2"> Status:</label>
    <select class="mr-5" [(ngModel)]="claimed" (change)="filter()">
        <option>Any</option>
        <option>Claimed</option>
        <option>Not Claimed</option>
    </select>


    <label class="mr-2"> Assignee:</label>
    <select class="mr-5" [(ngModel)]="assignee" (change)="filter()">
        <option>All</option>
        <option *ngFor="let assignee of assigneeList">{{assignee}}</option>
    </select>

    <label class="mr-2"> Owner:</label>
    <select class="mr-5" [(ngModel)]="owner" (change)="filter()">
        <option>All</option>
        <option *ngFor="let owner of ownerList">{{owner}}</option>
    </select>

    <input class="form-check-input" type="checkbox" [(ngModel)]="onlyDirectSignUp" (change)="filter()"
        id="onlyDirectSignUp">
    <label class="form-check-label mr-5" for="onlyDirectSignUp">
        Only Direct Sign Up
    </label>

    <label class="mr-2"> GMB:</label>
    <select class="mr-5" [(ngModel)]="gmb" (change)="filter()">
        <option>All</option>
        <option *ngFor="let gmb of gmbList">{{gmb}}</option>
    </select>

    <input class="form-check-input" type="checkbox" [(ngModel)]="pagination" id="paginationCheck">
    <label class="form-check-label mr-5" for="paginationCheck">
        Pagination
    </label>

</div>


<q-table [rows]="filteredTasks" [tableColumnDescriptors]="myColumnDescriptors" [compact]="true"
    [pageSize]="pagination ? 100 : 100000">
    <tr *tableRowTemplate="let task;">
        <td>{{filteredTasks.indexOf(task) + 1}}</td>
        <td>
            <div class="badge badge-{{getTaskClass(task)}}" *ngIf="!task.result">{{task.scheduledAt | ago: now}}</div>

            <div *ngIf="task.result">
                {{task.result}}
                <small class="text-muted d-block">
                    {{task.resultAt | date: 'short'}}
                </small>
            </div>
        </td>

        <td>{{task.name}}
            <div class="text-muted" *ngIf="task.description">
                <small>
                    <a target="_blank" href="#/restaurants/{{task.relatedMap?.qmenuId || task.gmbBiz?.qmenuId}}">{{task.description}}</a>
                     {{task.gmbBiz?.address}}
                    <div *ngIf="task.transfer && task.transfer.fromEmail">
                        <app-gmb-account-hotlink [email]="task.transfer.fromEmail"></app-gmb-account-hotlink>
                        <span *ngIf="task.transfer.againstEmail">Â« {{task.transfer.againstEmail | emailName}}</span>
                    </div>
                    <div *ngIf="task.etc && task.etc.fromEmail">
                        <app-gmb-account-hotlink [email]="task.etc.fromEmail"></app-gmb-account-hotlink>
                    </div>
                </small>
            </div>
        </td>
        <td>{{task.gmbBiz?.timeZone}}</td>
        <td class="{{task.transfer?.verificationOptions?.length > 0 ? 'bg-warning' : ''}}">
            <i class="fas fa-lock-open text-info" *ngIf="task.gmbBiz?.gmbOpen"></i>
            <div *ngIf="task.relatedMap.location?.statusHistory">
                {{task.relatedMap.location.statusHistory[0].time | ago : now}}
            </div>
            <ng-container *ngFor="let vo of task.transfer?.verificationOptions || []">
                <i *ngIf="!vo.unrecognized"
                    class="fas fa-{{vo.method === 'EMAIL' ? 'at' : (vo.method === 'PHONE' ? 'phone' : 'address-card')}} {{vo.requested ? 'text-success' : 'text-muted'}}"></i>
            </ng-container>
        </td>
        <td>{{task.gmbBiz?.gmbOwner}}</td>
        <td>{{task.score}}</td>
        <td>{{getRoles(task)}}</td>
        <td>{{task.assignee}}</td>
        <td>
            <!-- <div class="wrap">{{task.comments}}</div> -->
            <div class="wrap" [innerHTML]="task.comments"> </div>
            <div *ngIf="task.transfer && task.transfer.verificationMethod">
                {{task.transfer.verificationMethod}}
            </div>
        </td>
        <td>
            <app-task-action-bar [task]="task" [user]="user" (actionDone)="triggerActionDone($event)">
            </app-task-action-bar>
        </td>
        <td class="text-nowrap">
            {{task.createdAt | ago:now}}
            <div class="text-muted">
                <small>{{task._id}}</small>
            </div>
        </td>
    </tr>
</q-table>