<ng-container *ngIf="task">
  <div class="mb-4">
    <label>GMB Account</label>
    <div>
      <app-gmb-account-hotlink [email]="gmbAccount?.email"></app-gmb-account-hotlink><small class="text-muted"> click
        to login</small>
    </div>

  </div>

  <!-- <div class="alert alert-danger" *ngIf="gmbBiz && (!gmbBiz.bizManagedWebsite && !gmbBiz.qmenuWebsite)">
    <label>
      Missing either qMenu mangaged website or restaurant website.
    </label>
    <app-biz-website-editor [gmbBiz]="gmbBiz"></app-biz-website-editor>
  </div> -->

  <div class="mb-4">
    <label>
      Appeal
    </label>
    <div *ngIf="!task.etc.appealedAt">
      <button class="btn btn-sm btn-info" [qLoading]="gmbAppealing" (click)="appeal()">Appeal</button>
    </div>

    <div *ngIf="task.etc.appealedAt">
      Appealed {{task.etc.appealedAt | ago: now}}
      <div>
        <button class="btn btn-link px-0 fix-v-align" [qLoading]="gmbAppealing" (click)="appeal()">Re-Appeal</button>
      </div>

      <div class="alert alert-warning">Task was postponed 7 days automatically after appeal.</div>

    </div>
  </div>

  <div class="mb-4">
    <label>Schedule Followup At:</label>
    <input class="form-control" [owlDateTimeTrigger]="dt" [owlDateTime]="dt" [(ngModel)]="task.scheduledAt"
      (ngModelChange)="scheduledAtUpdated($event)">
    <owl-date-time #dt [hour12Timer]="true"></owl-date-time>
    <div class="py-1 text-right">
        <button type="button" class="btn btn-sm btn-info my-btn-narrow" *ngFor="let i of [3, 7, 30]" (click)="plusDay(i)">Today + {{i}}</button>
    </div>
  </div>

  <div class="form-group mb-4">
    <label>If Done, Select Result:</label>
    <q-simple-radio [(ngModel)]="result" [equalWidth]="true" [values]="['CANCELED', 'CLOSED']">
    </q-simple-radio>
  </div>

  <div class="form-group">
    <label>Comments:</label>
    <textarea class="form-control" rows="3" [(ngModel)]="comments" placeholder="extra comments"></textarea>
  </div>
  <div class="text-right">
    <button class="btn btn-primary" (click)="clickOk()">OK</button>
  </div>


  <button class="btn btn-link" (click)="showDetails = !showDetails">{{showDetails ? 'Hide details' : 'More
    details...'}}</button>
  <div class="card border-info" *qIf="showDetails">
    <div class="card-body">
      <h4>More Details</h4>
      <ng-container *ngIf="gmbBiz">
        <hr>
        <label>Restaurant:</label>
        <h6>
          <a target="_blank" routerLink="/restaurants/{{gmbBiz.qmenuId}}">{{gmbBiz.name}}</a>
        </h6>

        <table class="table table-sm" *ngIf="restaurantLogs.length > 0">
          <thead>
            <tr>
              <th scope="col">Date</th>
              <th scope="col">Problem</th>
              <th scope="col">Response</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let log of restaurantLogs">
              <td>{{log.time | date: 'short'}}</td>
              <td>{{log.problem}}</td>
              <td>{{log.response}}</td>
            </tr>
          </tbody>
        </table>

      </ng-container>

    </div>
  </div>
</ng-container>