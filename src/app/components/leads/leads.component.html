<h1 class="text-center">Lead Management</h1>
<div class="text-right pb-2">
  <ng-container *ngFor="let filter of ['classifications', 'serviceProviders', 'zipCode', 'city', 'state', 'rating']">
    <button *ngIf="searchFilter[filter]" class="btn btn-outline-success" (click)="removeFilter(filter)">{{searchFilter[filter]}}
      <span class="text-danger">âœ•</span>
    </button>
  </ng-container>

  <button class="btn btn-info" (click)="filter()">
    <i class="fas fa-filter"></i> Filter</button>
  <button class="btn btn-primary" (click)="createNew()">+ Add New Lead</button>
</div>
<table class="table table-hover table-responsive">
  <thead>
    <tr>
      <th scope="col">Name</th>
      <th scope="col">Street</th>
      <th scope="col">City</th>
      <th scope="col">Zip Code</th>
      <th scope="col">State</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let lead of leads">
      <th scope="row">{{lead.name}}</th>
      <td>{{lead.street}}</td>
      <td>{{lead.city}}</td>
      <td>{{lead.zipCode}}</td>
      <td>{{lead.state}}</td>
      <td class="text-right">
        <button class="btn btn-link py-0" (click)="view(lead)">
          <i class="fas fa-bars"></i>
        </button>
      </td>
    </tr>
  </tbody>
</table>
<q-modal [title]="leadInEditing._id ? 'Edit Restaurant Lead: ' + leadInEditing.name : 'Create New Restaurant Lead' " #editingModal>
  <q-form-builder [object]="leadInEditing" [showDelete]="leadInEditing._id" [fieldDescriptors]="formFieldDescriptors" (submit)="formSubmit($event)"
    (remove)="formRemove($event)" (cancel)="editingModal.hide()">
    <q-address-picker #myAddressPicker></q-address-picker>
    <div class="form-group">
      <label for="address-apt">Extra (APT, Suite etc.)</label>
      <input type="text" class="form-control" id="address-apt" placeholder="eg. APT 101 or Suite 300" [(ngModel)]="addressApt">
    </div>
  </q-form-builder>
</q-modal>

<q-modal [title]="'Filter Leads' " #filterModal>
  <q-form-builder [object]="searchFilter" [showDelete]="false" [fieldDescriptors]="filterFieldDescriptors" (submit)="filterSubmit($event)"
    (cancel)="filterModal.hide()">
    <div class="form-group">
      <label>Review Rating</label>
      <div>
        <q-rating [(ngModel)]="searchRating"></q-rating>
      </div>

    </div>
  </q-form-builder>
</q-modal>

<q-modal [title]="leadInEditing.name" #viewModal>
  <table class="table">
    <tbody>
      <tr>
        <th class="nowrap border-top-0">
          <i *ngIf="leadInEditing.address?.place_id" class="fas fa-check text-success"></i>
          <b>Address</b>
        </th>
        <td class="border-top-0">
          <a href="https://www.google.com/maps/search/?api=1&query={{leadInEditing.street}} {{leadInEditing.city}} {{leadInEditing.state}}"
            target="_blank">{{leadInEditing.street}}, {{leadInEditing.city}}, {{leadInEditing.state}} {{leadInEditing.zipCode}}</a>
        </td>
      </tr>
      <tr>
        <th class="nowrap border-top-0">
          <i *ngIf="leadInEditing.address?.place_id" class="fas fa-check text-success"></i>
          <b>Phones</b>
        </th>
        <td class="border-top-0">
          <a *ngFor="let phone of leadInEditing.phones" href="tel:{{phone}}">{{phone | tel}}&nbsp;&nbsp;</a>
        </td>
      </tr>
      <tr>
        <th class="nowrap border-top-0">
          <i *ngIf="leadInEditing.address?.place_id" class="fas fa-check text-success"></i>
          <b>Email</b>
        </th>
        <td class="border-top-0">
          <a *ngIf="leadInEditing.email" href="mailto:{{leadInEditing.email}}">{{leadInEditing.email}}</a>
        </td>
      </tr>
      <tr>
        <th class="nowrap border-top-0">
          <i *ngIf="leadInEditing.address?.place_id" class="fas fa-check text-success"></i>
          <b>Website</b>
        </th>
        <td class="border-top-0">
          <a *ngIf="leadInEditing.webSite" href="{{leadInEditing.webSite}}" target="_blank">{{leadInEditing.webSite}}</a>
        </td>
      </tr>
      <tr>
        <th class="nowrap border-top-0">
          <i *ngIf="leadInEditing.address?.place_id" class="fas fa-check text-success"></i>
          <b>Classifications</b>
        </th>
        <td class="border-top-0"> {{(leadInEditing.classifications || []).join(', ')}}</td>
      </tr>
    </tbody>

  </table>
</q-modal>
